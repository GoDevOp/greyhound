#!/usr/bin/env bash

case $1 in
start)
    /etc/init.d/gh_fe start
    /etc/init.d/gh_ws start
    /etc/init.d/gh_db start
    /etc/init.d/gh_dist start
    /etc/init.d/gh_sh start
    /etc/init.d/gh_web start
    ;;
stop)
    /etc/init.d/gh_fe stop
    /etc/init.d/gh_ws stop
    /etc/init.d/gh_db stop
    /etc/init.d/gh_dist stop
    /etc/init.d/gh_sh stop
    /etc/init.d/gh_web stop

    sudo mongod --shutdown --dbpath ~/data > /dev/null 2>&1;
    echo -e "select 0\nflushdb" | redis-cli > /dev/null 2>&1;
    ;;
auto)
    # Remove all auto-launch services.
    update-rc.d -f gh_fe remove
    update-rc.d -f gh_ws remove
    update-rc.d -f gh_db remove
    update-rc.d -f gh_dist remove
    update-rc.d -f gh_sh remove
    update-rc.d -f gh_web remove

    # Re-add auto-launch services.
    update-rc.d gh_fe defaults 95 05
    update-rc.d gh_ws defaults 96 04
    update-rc.d gh_db defaults 96 04
    update-rc.d gh_dist defaults 96 04
    update-rc.d gh_sh defaults 96 04
    update-rc.d gh_web defaults 96 04
    ;;
status)
    for key in `echo "KEYS services/*" | redis-cli`; do
        echo `echo "GET $key" | redis-cli`
    done
    ;;
*)
    echo "Usage: $0 {start|stop}" >&2

esac

